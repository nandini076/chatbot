<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nexa (Standalone Test)</title>

  <!-- Material icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />

  <style>
    /* --- Minimal / reliable CSS based on your theme --- */
    :root{
      --primary:#6c5ce7; --secondary:#a363d9; --accent:#ff6b6b;
      --chat-bg: rgba(255,255,255,0.95);
      --radius: 12px;
    }
    *{box-sizing:border-box;font-family:Inter, Poppins, system-ui, sans-serif}
    body{min-height:100vh;margin:0;background:linear-gradient(45deg,#6c5ce7,#a363d9);display:flex;align-items:center;justify-content:center;padding:2rem}
    /* welcome */
    .welcome-screen{color:#f1f5f9;text-align:center;max-width:720px;padding:2rem;border-radius:16px;background:rgba(255,255,255,0.06);backdrop-filter:blur(6px)}
    .welcome-title{font-size:2rem;margin-bottom:.25rem}
    .start-hint{opacity:.9;margin-top:1rem}

    /* Toggler */
    .chatbot-toggler{
      position:fixed;right:1.5rem;bottom:1.5rem;width:60px;height:60px;border-radius:50%;
      background:linear-gradient(145deg,var(--primary),var(--secondary));
      display:flex;align-items:center;justify-content:center;color:#fff;border:none;cursor:pointer;
      box-shadow:0 8px 30px rgba(0,0,0,0.25);z-index:9999;
    }
    .chatbot-toggler span { display:flex; align-items:center; justify-content:center; font-size:24px }
    /* toggler icon swap */
    .chatbot-toggler .close-icon{ opacity:0; position:absolute; transition:.18s; }
    body.show-chatbot .chatbot-toggler .close-icon{ opacity:1 }
    body.show-chatbot .chatbot-toggler .open-icon{ opacity:0 }

    /* Chat window */
    .chatbot{
      position:fixed; right:1.5rem; bottom:6.2rem; width:360px; height:520px;
      border-radius:var(--radius); background:var(--chat-bg); box-shadow:0 20px 60px rgba(0,0,0,.25);
      transform:scale(.9); opacity:0; pointer-events:none; transition:all .22s ease; overflow:hidden; z-index:9998;
    }
    body.show-chatbot .chatbot{ transform:scale(1); opacity:1; pointer-events:auto }

    .chatbot-header{ background:var(--primary); color:#fff; padding:12px 16px; display:flex; align-items:center; gap:8px }
    .bot-avatar{ background:rgba(255,255,255,0.12); padding:8px; border-radius:50% }
    .status-indicator{ margin-left:auto; background: rgba(74,222,128,0.12); color:#4ade80; padding:4px 8px; border-radius:999px; font-size:.8rem }

    .chatbox{ height:calc(100% - 120px); overflow-y:auto; padding:12px; background:#fff; }
    .chat{ display:flex; margin-bottom:12px; gap:8px; align-items:flex-end }
    .chat.incoming .message{ background:#f3f4f6; color:#111; border-radius:12px 12px 12px 4px; padding:10px; max-width:75% }
    .chat.outgoing{ justify-content:flex-end }
    .chat.outgoing .message{ background:linear-gradient(135deg,var(--primary),var(--secondary)); color:#fff; padding:10px; border-radius:12px 12px 4px 12px; max-width:75% }

    .chat-time{ font-size:.72rem; color:#8892a6; margin-left:8px; align-self:flex-end }

    .chat-input{ position:absolute; bottom:0; left:0; right:0; background:#fff; padding:12px; border-top:1px solid #eee }
    .input-wrapper{ display:flex; gap:8px; align-items:center }
    textarea{ flex:1; min-height:40px; max-height:120px; resize:none; padding:10px; border-radius:10px; border:1px solid #e6e6e6; outline:none; font-size:14px }
    .send-btn{ width:44px; height:44px; border-radius:50%; border:none; background:var(--primary); color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; opacity:.95 }

    /* small responsive */
    @media (max-width:520px){
      .chatbot{ right:1rem; left:1rem; width:auto; height:70vh; bottom:6.5rem }
      .chatbox{ height:calc(100% - 140px) }
    }
  </style>
</head>
<body>

  <main class="welcome-screen">
    <h1 class="welcome-title">Welcome to Nexa</h1>
    <p class="welcome-text">Your AI Assistant for Smart Conversations</p>
    <p class="start-hint">Click the chat icon at bottom-right to open the chat.</p>
  </main>

  <!-- CHAT TOGGLER -->
  <button class="chatbot-toggler" aria-label="Open chat">
    <span class="material-symbols-rounded open-icon">mode_comment</span>
    <span class="material-symbols-outlined close-icon">close</span>
  </button>

  <!-- CHAT WINDOW -->
  <div class="chatbot" role="dialog" aria-label="Chat with Nexa">
    <header class="chatbot-header">
      <span class="bot-avatar material-symbols-outlined">smart_toy</span>
      <div>
        <div style="font-weight:600">Nexa</div>
        <div style="font-size:.78rem;opacity:.9">Your friendly assistant</div>
      </div>
      <div class="status-indicator">Online</div>
      <button class="close-btn material-symbols-outlined" style="margin-left:8px;background:none;border:none;color:#fff;cursor:pointer">close</button>
    </header>

    <ul class="chatbox" role="log" aria-live="polite">
      <li class="chat incoming">
        <span class="material-symbols-outlined">smart_toy</span>
        <div class="message">
          <p>Hello! ðŸ‘‹ I'm Nexa â€” ask me anything.</p>
        </div>
        <time class="chat-time">Now</time>
      </li>
    </ul>

    <div class="chat-input">
      <div class="input-wrapper">
        <textarea placeholder="Type your message..." aria-label="Chat message"></textarea>
        <button class="send-btn" aria-label="Send"><span class="material-symbols-outlined">send</span></button>
      </div>
    </div>
  </div>

<script>
/* Minimal, robust JS to ensure toggler + send work reliably.
   This is a single-file test that you can run immediately. */

document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;
  const toggler = document.querySelector('.chatbot-toggler');
  const closeBtn = document.querySelector('.close-btn');
  const chatbot = document.querySelector('.chatbot');
  const textarea = document.querySelector('.chat-input textarea');
  const sendBtn = document.querySelector('.send-btn');
  const chatbox = document.querySelector('.chatbox');

  if (!toggler || !closeBtn || !chatbot || !textarea || !sendBtn || !chatbox) {
    console.error('Missing one or more required elements. Check selectors.');
    return;
  }

  // Toggle open/close
  toggler.addEventListener('click', (e) => {
    e.preventDefault();
    body.classList.toggle('show-chatbot');
    // set aria label
    toggler.setAttribute('aria-pressed', body.classList.contains('show-chatbot'));
  });

  // Close button inside header
  closeBtn.addEventListener('click', (e) => {
    e.preventDefault();
    body.classList.remove('show-chatbot');
    toggler.setAttribute('aria-pressed', false);
  });

  // Scroll helper
  const scrollToBottom = () => {
    chatbox.scrollTo({ top: chatbox.scrollHeight, behavior: 'smooth' });
  };

  // Create message li
  function appendMessage(text, type = 'incoming') {
    const li = document.createElement('li');
    li.className = 'chat ' + type;

    if (type === 'outgoing') {
      li.innerHTML = `
        <div class="message"><p>${escapeHtml(text)}</p></div>
        <time class="chat-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</time>
      `;
    } else {
      li.innerHTML = `
        <span class="material-symbols-outlined">smart_toy</span>
        <div class="message"><p>${escapeHtml(text)}</p></div>
        <time class="chat-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</time>
      `;
    }
    chatbox.appendChild(li);
    scrollToBottom();
  }

  // Basic safe escape
  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // Basic bot reply (local logic + small delay)
  async function botReply(userText) {
    // show small typing indicator message
    appendMessage('Thinking...', 'incoming');
    await new Promise(r => setTimeout(r, 700));
    // remove last 'Thinking...' (simple approach)
    const items = chatbox.querySelectorAll('li.chat');
    const last = items[items.length - 1];
    if (last && last.querySelector('.message p').textContent === 'Thinking...') {
      last.remove();
    }

    // simple canned responses
    const text = userText.toLowerCase();
    if (/\b(hi|hello|hey)\b/.test(text)) appendMessage("Hey! I'm Nexa â€” how can I help?");
    else if (/\b(name|who are you)\b/.test(text)) appendMessage("I'm Nexa â€” your friendly chatbot.");
    else if (/\b(thank|thanks)\b/.test(text)) appendMessage("You're welcome! ðŸ˜Š");
    else if (/\b(help|what can you do)\b/.test(text)) appendMessage("I can chat, do simple math, or fetch advice. Try '2+2' or ask for a joke!");
    else if (/\d+\s*[\+\-\*x]\s*\d+/.test(text)) {
      try {
        // evaluate simple math safely
        const cleaned = text.replace(/x/g, '*').match(/(\d+(\.\d+)?)\s*([\+\-\*])\s*(\d+(\.\d+)?)/);
        if (cleaned) {
          const a = parseFloat(cleaned[1]), op = cleaned[3], b = parseFloat(cleaned[4]);
          let res = '';
          if (op === '+') res = `${a+b}`;
          if (op === '-') res = `${a-b}`;
          if (op === '*') res = `${a*b}`;
          appendMessage(`Result: ${res}`);
        } else appendMessage("Sorry, I couldn't compute that.");
      } catch (err) {
        appendMessage("Error computing expression.");
      }
    } else {
      // fallback: advice API (no key) â€” optional, but safe to attempt
      try {
        const r = await fetch('https://api.adviceslip.com/advice', {cache:'no-store'});
        const j = await r.json();
        appendMessage(j?.slip?.advice || "Here's something to think about!");
      } catch {
        appendMessage("Hmm â€” tell me more about that.");
      }
    }
  }

  // Send handler
  function sendHandler() {
    const text = textarea.value.trim();
    if (!text) return;
    appendMessage(text, 'outgoing');
    textarea.value = '';
    textarea.style.height = '40px';
    scrollToBottom();
    botReply(text);
  }

  // Enter to send (shift+enter newline)
  textarea.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendHandler();
    }
  });

  sendBtn.addEventListener('click', (e) => {
    e.preventDefault();
    sendHandler();
  });

  // initial scroll
  scrollToBottom();
});
</script>
</body>
</html>
